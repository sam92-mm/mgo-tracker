<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGO Live Tracker</title>
    <style>
        :root { --p: #2ecc71; --s: #3498db; --d: #2c3e50; --bg: #f4f7f6; --err: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .app { max-width: 450px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: var(--d); color: white; padding: 20px; text-align: center; }
        .clock { font-family: monospace; font-size: 28px; color: var(--p); }
        .status-bar { font-size: 11px; padding: 8px; text-align: center; background: #eee; font-weight: bold; }
        .card { display: flex; justify-content: space-between; padding: 15px 20px; border-bottom: 1px solid #eee; align-items: center; }
        .card.live { border-left: 5px solid var(--err); background: #fff5f5; }
        .name { font-weight: bold; }
        .time { color: var(--s); font-family: monospace; }
        .loader { padding: 40px; text-align: center; color: #7f8c8d; }
        button { background: var(--p); color: white; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="app">
    <div id="status" class="status-bar">VALMISTELLAAN HAKUA...</div>
    <div class="header">
        <div id="clock" class="clock">00:00:00</div>
        <div id="date">Ladataan...</div>
    </div>
    <div id="eventList" class="event-list">
        <div class="loader">Yritetään ohittaa Wikin suojaus...</div>
    </div>
    <button onclick="fetchEvents()">PÄIVITÄ LISTA</button>
</div>

<script>
    async function fetchEvents() {
        const status = document.getElementById('status');
        const list = document.getElementById('eventList');
        
        // Luodaan tämän päivän URL dynaamisesti (February 10, 2026)
        const d = new Date();
        const monthL = ["january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december"][d.getMonth()];
        const targetUrl = `https://monopolygo.wiki/todays-events-${monthL}-${d.getDate()}-${d.getFullYear()}/`;
        
        // Käytetään AllOrigins-proxyä
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

        status.innerText = "YHDISTETÄÄN VÄLITYSPALVELIMEEN...";

        try {
            const response = await fetch(proxyUrl);
            const data = await response.json();
            const html = data.contents;

            if (!html) throw new Error("Sivua ei voitu ladata.");

            const events = [];
            // Etsitään kelloajat ja nimet HTML-massasta
            const regex = /(\d{1,2}:\d{2}\s*(?:AM|PM)?\s*-\s*\d{1,2}:\d{2}\s*(?:AM|PM)?)[^>]*>([^<]+)/gi;
            
            let match;
            while ((match = regex.exec(html)) !== null) {
                let time = match[1].trim();
                let name = match[2].trim();
                if (name.length > 2 && name.length < 50 && !name.includes("{")) {
                    events.push({ time, name });
                }
            }

            if (events.length === 0) {
                status.innerText = "WIKI ESTI MYÖS TÄMÄN YRITYKSEN (403)";
                list.innerHTML = `<div class="loader">Suojaus on liian vahva automaattiseen hakuun juuri nyt.</div>`;
                return;
            }

            status.innerText = "PÄIVITETTY " + new Date().toLocaleTimeString();
            render(events);

        } catch (e) {
            status.innerText = "VIRHE YHTEYDESSÄ";
            list.innerHTML = `<div class="loader">Yhteys epäonnistui.</div>`;
        }
    }

    function render(events) {
        const list = document.getElementById('eventList');
        list.innerHTML = events.map(ev => `
            <div class="card">
                <div class="name">${ev.name}</div>
                <div class="time">${ev.time}</div>
            </div>
        `).join('');
    }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('fi-FI');
        document.getElementById('date').innerText = new Date().toLocaleDateString('fi-FI', {weekday:'long', day:'numeric', month:'long'});
    }, 1000);

    window.onload = fetchEvents;
</script>

</body>
</html>
